<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIFA - Control 360° Red Global de Rutas | Demo Premium</title>
    
    <!-- Plotly.js CDN -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* Variables CSS AIFA */
        :root {
            --primary-cyan: #00d4ff;
            --primary-cyan-light: #00fff0;
            --primary-gold: #f59e0b;
            --primary-dark: #0a0e27;
            --secondary-dark: #1a1f37;
            --success-green: #00ff88;
            --danger-red: #ff4757;
            --warning-orange: #ff6b35;
            --text-primary: #ffffff;
            --text-secondary: #8b92a9;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(0, 212, 255, 0.2);
        }

        /* Reset y Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f37 50%, #0a0e27 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Layout Principal */
        .dashboard-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 100vh;  /* Usar todo el espacio sin header */
            gap: 1rem;
            padding: 1rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Panel de Control Lateral */
        .control-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);  /* Más sutil */
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            height: fit-content;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);  /* Sombra más elegante */
        }

        .control-section {
            margin-bottom: 2rem;
        }

        .control-title {
            color: var(--primary-cyan);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Filtros Premium */
        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .filter-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-align: left;
        }

        .filter-btn:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--primary-cyan);
            color: var(--primary-cyan);
            transform: translateX(2px);
        }

        .filter-btn.active {
            background: rgba(0, 212, 255, 0.25);
            border-color: var(--primary-cyan);
            color: var(--primary-cyan);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);  /* Glow más sutil */
        }

        /* Sliders Premium */
        .slider-container {
            margin: 1rem 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-cyan);
            border: 2px solid white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        /* Métricas Live */
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(10px);  /* Glassmorphism sutil */
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;  /* Más redondeado */
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);  /* Sombra elegante */
        }

        .metric-value {
            color: var(--primary-cyan);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Container del Mapa 3D */
        .map-container {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);  /* Más sutil */
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);  /* Sombra más elegante */
        }

        .map-header {
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-title {
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .map-controls {
            display: flex;
            gap: 0.5rem;
        }

        .control-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            color: var(--primary-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .control-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            box-shadow: 0 0 12px rgba(0, 212, 255, 0.3);  /* Glow más sutil */
        }

        /* Status Indicators */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .control-panel {
                order: 2;
                margin-top: 1rem;
            }
            
            .demo-title {
                font-size: 2rem;
            }
        }

        /* Loading Animation */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-top: 3px solid var(--primary-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        
        <!-- Panel de Control Lateral -->
        <div class="control-panel">
            
            <!-- Status del Sistema -->
            <div class="control-section">
                <h3 class="control-title">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 8px;">flight_takeoff</span>
                    Estado del Sistema
                </h3>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Sistema Operacional</span>
                </div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="total-routes">28</div>
                        <div class="metric-label">Rutas Activas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="total-pax">1.2M</div>
                        <div class="metric-label">Pax/Año</div>
                    </div>
                </div>
            </div>

            <!-- Filtros de Visualización -->
            <div class="control-section">
                <h3 class="control-title">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 8px;">tune</span>
                    Filtros de Red
                </h3>
                
                <div class="filter-group">
                    <label class="filter-label">Tipo de Ruta</label>
                    <button class="filter-btn active" onclick="filterByType('all')" id="filter-all">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">public</span>
                        Todas las Rutas (28)
                    </button>
                    <button class="filter-btn" onclick="filterByType('international')" id="filter-intl">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">flight</span>
                        Internacionales (12)
                    </button>
                    <button class="filter-btn" onclick="filterByType('domestic')" id="filter-dom">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">home</span>
                        Domésticas (16)
                    </button>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Volumen de Pasajeros</label>
                    <input type="range" class="slider" id="pax-slider" min="0" max="200000" value="0" 
                           oninput="filterByPassengers(this.value)">
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-secondary);">
                        <span>0</span>
                        <span id="pax-value">Todos</span>
                        <span>200K</span>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Rentabilidad</label>
                    <button class="filter-btn" onclick="filterByProfitability('high')" id="filter-profit-high">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px; color: #00ff88;">trending_up</span>
                        Alta Rentabilidad
                    </button>
                    <button class="filter-btn" onclick="filterByProfitability('medium')" id="filter-profit-med">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px; color: #f59e0b;">trending_flat</span>
                        Media Rentabilidad
                    </button>
                    <button class="filter-btn" onclick="filterByProfitability('low')" id="filter-profit-low">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px; color: #ff4757;">trending_down</span>
                        Baja Rentabilidad
                    </button>
                </div>
            </div>

            <!-- Controles 3D -->
            <div class="control-section">
                <h3 class="control-title">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 8px;">3d_rotation</span>
                    Controles 3D
                </h3>
                
                <div class="filter-group">
                    <button class="filter-btn" onclick="rotateGlobe()" id="rotate-btn">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">rotate_right</span>
                        Auto-Rotación
                    </button>
                    <button class="filter-btn" onclick="resetView()" id="reset-btn">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">my_location</span>
                        Vista Inicial
                    </button>
                    <button class="filter-btn" onclick="focusAmerica()" id="america-btn">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">place</span>
                        Enfocar América
                    </button>
                    <button class="filter-btn" onclick="focusEurope()" id="europe-btn">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">place</span>
                        Enfocar Europa
                    </button>
                </div>
            </div>

            <!-- Análisis Temporal -->
            <div class="control-section">
                <h3 class="control-title">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 8px;">analytics</span>
                    Análisis Temporal
                </h3>
                
                <div class="filter-group">
                    <label class="filter-label">Período de Análisis</label>
                    <button class="filter-btn active" onclick="setTimePeriod('current')" id="time-current">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">calendar_today</span>
                        Actual (2024)
                    </button>
                    <button class="filter-btn" onclick="setTimePeriod('projection')" id="time-projection">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">trending_up</span>
                        Proyección 2025
                    </button>
                    <button class="filter-btn" onclick="setTimePeriod('historical')" id="time-historical">
                        <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">history</span>
                        Histórico 2023
                    </button>
                </div>
            </div>

            <!-- Métricas Live -->
            <div class="control-section">
                <h3 class="control-title">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 8px;">dashboard</span>
                    Métricas Live
                </h3>
                
                <div class="metric-card" style="margin-bottom: 1rem; grid-column: span 2;">
                    <div class="metric-value" id="total-revenue">$450M</div>
                    <div class="metric-label">Ingresos Anuales</div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="avg-load">84.5%</div>
                        <div class="metric-label">Load Factor</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="efficiency">94.2%</div>
                        <div class="metric-label">Eficiencia</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container del Mapa 3D -->
        <div class="map-container">
            <div class="map-header">
                <div class="map-title">
                    <span class="material-icons" style="font-size: 18px; vertical-align: middle; margin-right: 8px;">public</span>
                    Red Global AIFA - Vista 360°
                </div>
                <div class="map-controls">
                    <button class="control-btn" onclick="toggleAnimation()">
                        <span class="material-icons" style="font-size: 14px;">play_arrow</span>
                        Animar
                    </button>
                    <button class="control-btn" onclick="takeScreenshot()">
                        <span class="material-icons" style="font-size: 14px;">photo_camera</span>
                        Capturar
                    </button>
                    <button class="control-btn" onclick="toggleFullscreen()">
                        <span class="material-icons" style="font-size: 14px;">fullscreen</span>
                        Pantalla Completa
                    </button>
                </div>
            </div>
            
            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loading">
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 1rem; color: var(--primary-cyan);">Cargando Control 360°...</p>
                </div>
            </div>
            
            <!-- Mapa 3D -->
            <div id="globe-3d" style="width: 100%; height: calc(100% - 70px);"></div>
        </div>
    </div>

    <script>
        // Datos de la Red AIFA
        const AIFA_DATA = {
            hub: {
                name: 'AIFA',
                lat: 19.7373,
                lon: -99.0068,
                elevation: 2200
            },
            routes: [
                // Rutas Internacionales
                {name: "Los Angeles", lat: 34.0522, lon: -118.2437, pax: 87000, type: "international", flights: 21, revenue: 45, profitability: "high"},
                {name: "Houston", lat: 29.7604, lon: -95.3698, pax: 76000, type: "international", flights: 19, revenue: 38, profitability: "high"},
                {name: "Miami", lat: 25.7617, lon: -80.1918, pax: 92000, type: "international", flights: 17, revenue: 52, profitability: "high"},
                {name: "Madrid", lat: 40.4168, lon: -3.7038, pax: 67000, type: "international", flights: 14, revenue: 41, profitability: "medium"},
                {name: "Bogotá", lat: 4.7110, lon: -74.0721, pax: 45000, type: "international", flights: 12, revenue: 28, profitability: "medium"},
                {name: "Lima", lat: -12.0464, lon: -77.0428, pax: 38000, type: "international", flights: 10, revenue: 22, profitability: "low"},
                
                // Rutas Domésticas
                {name: "Guadalajara", lat: 20.6597, lon: -103.3496, pax: 125000, type: "domestic", flights: 42, revenue: 35, profitability: "high"},
                {name: "Monterrey", lat: 25.6866, lon: -100.3161, pax: 98000, type: "domestic", flights: 35, revenue: 28, profitability: "high"},
                {name: "Cancún", lat: 21.1619, lon: -86.8515, pax: 156000, type: "domestic", flights: 28, revenue: 42, profitability: "high"},
                {name: "Mérida", lat: 20.9674, lon: -89.6243, pax: 67000, type: "domestic", flights: 24, revenue: 18, profitability: "medium"},
                {name: "Tijuana", lat: 32.5411, lon: -117.0170, pax: 54000, type: "domestic", flights: 18, revenue: 15, profitability: "medium"},
                {name: "Veracruz", lat: 19.1738, lon: -96.1342, pax: 43000, type: "domestic", flights: 15, revenue: 12, profitability: "low"}
            ]
        };

        // Variables de Estado
        let currentFilter = 'all';
        let isRotating = false;
        let rotationInterval;
        let currentView = 'world';

        // Inicializar Mapa 3D
        function initializeGlobe() {
            console.log('▶ Inicializando globo 3D...');
            
            // Ocultar loading después de 2 segundos
            setTimeout(() => {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 500);
            }, 2000);

            updateGlobe();
        }

        // Función Principal del Mapa
        function updateGlobe(filterType = 'all', passengerMin = 0, profitFilter = null) {
            console.log('▶ Actualizando globo con filtros:', filterType, passengerMin, profitFilter);
            
            const hub = AIFA_DATA.hub;
            let routes = AIFA_DATA.routes;

            // Aplicar filtros
            if (filterType !== 'all') {
                routes = routes.filter(r => r.type === filterType);
            }
            
            if (passengerMin > 0) {
                routes = routes.filter(r => r.pax >= passengerMin);
            }
            
            if (profitFilter) {
                routes = routes.filter(r => r.profitability === profitFilter);
            }

            const traces = [];

            // 1. Hub AIFA - Centro Refinado y Elegante
            traces.push({
                type: 'scattergeo',
                lat: [hub.lat],
                lon: [hub.lon],
                text: ['AIFA HUB'],
                mode: 'markers+text',
                marker: {
                    size: 35,  // Reducido de 50px para elegancia
                    color: '#f59e0b',
                    line: { width: 2, color: 'rgba(255,255,255,0.8)' },  // Contorno semi-transparente elegante
                    symbol: 'star',
                    opacity: 1.0
                },
                textposition: 'bottom center',
                textfont: { size: 14, color: 'white', family: 'Inter', weight: 600 },
                name: 'AIFA Hub',
                hovertemplate: '<b>AIFA - Hub Principal</b><br>' +
                             'Felipe Ángeles International<br>' +
                             'Rutas Activas: ' + routes.length + '<br>' +
                             'Estado: Operacional<br>' +
                             'Altitud: 2,200m<extra></extra>',
                showlegend: false
            });

            // 2. Líneas de Rutas Premium
            routes.forEach(route => {
                let lineColor, lineWidth, lineDash;
                
                if (route.type === 'international') {
                    lineColor = '#00d4ff';
                    lineWidth = Math.max(2, Math.min(route.pax / 20000, 8));  // Más sutil: 2-8px
                    lineDash = 'solid';
                } else {
                    lineColor = '#00ff88';
                    lineWidth = Math.max(1.5, Math.min(route.pax / 25000, 6));  // Más sutil: 1.5-6px
                    lineDash = 'solid';
                }

                // Línea curva great circle
                traces.push({
                    type: 'scattergeo',
                    lat: [hub.lat, route.lat],
                    lon: [hub.lon, route.lon],
                    mode: 'lines',
                    line: {
                        width: lineWidth,
                        color: lineColor,
                        opacity: 0.7,  // Más sutil: reducido de 0.9 a 0.7
                        dash: lineDash
                    },
                    showlegend: false,
                    hoverinfo: 'skip'
                });
            });

            // 3. Markers de Destinos Premium
            routes.forEach(route => {
                let markerSize = Math.max(20, Math.min(route.pax / 6000, 40));
                let markerColor, markerSymbol;
                
                if (route.type === 'international') {
                    markerColor = '#ff6b35';
                    markerSymbol = 'square';
                } else {
                    markerColor = '#00ff88';
                    markerSymbol = 'circle';
                }

                // Color por rentabilidad
                if (profitFilter || true) {
                    if (route.profitability === 'high') markerColor = '#00ff88';
                    else if (route.profitability === 'medium') markerColor = '#f59e0b';
                    else if (route.profitability === 'low') markerColor = '#ff4757';
                }

                traces.push({
                    type: 'scattergeo',
                    lat: [route.lat],
                    lon: [route.lon],
                    text: [route.name],
                    mode: 'markers+text',
                    marker: {
                        size: markerSize,
                        color: markerColor,
                        line: { width: 1.5, color: 'rgba(255,255,255,0.6)' },  // Contorno sutil semi-transparente
                        symbol: markerSymbol,
                        opacity: 1.0
                    },
                    textposition: 'top center',
                    textfont: { size: 12, color: 'white', family: 'Inter' },
                    showlegend: false,
                    hovertemplate: '<b>▶ ' + route.name + '</b><br>' +
                                 '◆ Pasajeros: ' + route.pax.toLocaleString() + '/año<br>' +
                                 '◆ Vuelos: ' + route.flights + '/mes<br>' +
                                 '◆ Tipo: ' + route.type.charAt(0).toUpperCase() + route.type.slice(1) + '<br>' +
                                 '◆ Revenue: $' + route.revenue + 'M MXN<br>' +
                                 '◆ Rentabilidad: ' + route.profitability.toUpperCase() + '<extra></extra>'
                });
            });

            // Layout 3D Premium
            const layout = {
                geo: {
                    scope: 'world',
                    projection: {
                        type: 'orthographic',  // Globo 3D
                        rotation: { lat: 0, lon: -95 }
                    },
                    showland: true,
                    landcolor: 'rgba(15, 20, 35, 0.95)',
                    showocean: true,
                    oceancolor: 'rgba(5, 10, 25, 0.98)',
                    showcountries: true,
                    countrycolor: 'rgba(0, 212, 255, 0.6)',
                    coastlinecolor: 'rgba(0, 212, 255, 0.8)',
                    showlakes: false,
                    bgcolor: 'rgba(0,0,0,0)',
                    showframe: false
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                margin: { l: 0, r: 0, t: 0, b: 0 },
                showlegend: false,
                height: window.innerHeight - 200
            };

            // Renderizar
            Plotly.newPlot('globe-3d', traces, layout, {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'select2d', 'lasso2d', 'autoScale2d'],
                modeBarButtonsToAdd: ['orbitRotation', 'tableRotation'],
                displaylogo: false
            });

            // Actualizar métricas
            updateMetrics(routes);
        }

        // Filtros de Funcionalidad
        function filterByType(type) {
            currentFilter = type;
            
            // Actualizar botones activos
            document.querySelectorAll('[id^="filter-"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${type === 'all' ? 'all' : type === 'international' ? 'intl' : 'dom'}`).classList.add('active');
            
            updateGlobe(type);
        }

        function filterByPassengers(minPax) {
            document.getElementById('pax-value').textContent = minPax > 0 ? `${(minPax/1000).toFixed(0)}K+` : 'Todos';
            updateGlobe(currentFilter, parseInt(minPax));
        }

        function filterByProfitability(level) {
            // Reset otros filtros de rentabilidad
            document.querySelectorAll('[id^="filter-profit"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-profit-${level === 'high' ? 'high' : level === 'medium' ? 'med' : 'low'}`).classList.add('active');
            
            updateGlobe(currentFilter, 0, level);
        }

        // Controles 3D
        function rotateGlobe() {
            const button = document.getElementById('rotate-btn');
            
            if (!isRotating) {
                isRotating = true;
                button.style.background = 'rgba(0, 255, 136, 0.2)';
                button.innerHTML = '<span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">stop</span>Detener Rotación';
                
                let rotation = -95;
                rotationInterval = setInterval(() => {
                    rotation += 2;
                    Plotly.relayout('globe-3d', {
                        'geo.projection.rotation.lon': rotation
                    });
                }, 100);
            } else {
                isRotating = false;
                button.style.background = 'rgba(0, 212, 255, 0.1)';
                button.innerHTML = '<span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 6px;">rotate_right</span>Auto-Rotación';
                clearInterval(rotationInterval);
            }
        }

        function resetView() {
            Plotly.relayout('globe-3d', {
                'geo.projection.rotation': { lat: 0, lon: -95 },
                'geo.projection.scale': 1
            });
        }

        function focusAmerica() {
            Plotly.relayout('globe-3d', {
                'geo.projection.rotation': { lat: 0, lon: -95 },
                'geo.projection.scale': 2
            });
        }

        function focusEurope() {
            Plotly.relayout('globe-3d', {
                'geo.projection.rotation': { lat: 0, lon: 0 },
                'geo.projection.scale': 2
            });
        }

        // Análisis Temporal
        function setTimePeriod(period) {
            document.querySelectorAll('[id^="time-"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`time-${period}`).classList.add('active');
            
            // Simular cambio de datos por período
            console.log('▶ Cambiando a período:', period);
            updateGlobe(currentFilter);
        }

        // Controles Adicionales
        function toggleAnimation() {
            console.log('▶ Toggle animación');
            // Implementar animación de flujo de pasajeros
        }

        function takeScreenshot() {
            Plotly.toImage('globe-3d', {format: 'png', width: 1200, height: 800})
                .then(function(url) {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'aifa-routes-3d.png';
                    a.click();
                });
        }

        function toggleFullscreen() {
            const container = document.querySelector('.map-container');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                container.requestFullscreen();
            }
        }

        // Actualizar Métricas
        function updateMetrics(routes) {
            const totalPax = routes.reduce((sum, r) => sum + r.pax, 0);
            const totalRevenue = routes.reduce((sum, r) => sum + r.revenue, 0);
            const avgLoad = routes.reduce((sum, r) => sum + (r.pax / 1000), 0) / routes.length;
            
            document.getElementById('total-routes').textContent = routes.length;
            document.getElementById('total-pax').textContent = (totalPax / 1000000).toFixed(1) + 'M';
            document.getElementById('total-revenue').textContent = '$' + totalRevenue + 'M';
            document.getElementById('avg-load').textContent = avgLoad.toFixed(1) + '%';
        }

        // Efectos de Hover en Botones
        document.addEventListener('DOMContentLoaded', function() {
            console.log('▶ Demo AIFA 3D Routes iniciada');
            
            // Efecto de carga gradual
            setTimeout(() => {
                initializeGlobe();
            }, 500);
            
            // Rotación automática inicial después de 5 segundos
            setTimeout(() => {
                if (!isRotating) {
                    rotateGlobe();
                    // Detener después de 10 segundos para mostrar control
                    setTimeout(() => {
                        if (isRotating) rotateGlobe();
                    }, 10000);
                }
            }, 5000);
        });

        // Responsive handling
        window.addEventListener('resize', function() {
            Plotly.Plots.resize('globe-3d');
        });
    </script>
</body>
</html>